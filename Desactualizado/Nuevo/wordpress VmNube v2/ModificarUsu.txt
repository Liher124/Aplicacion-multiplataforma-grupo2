<?php
session_start();
if(isset($_SESSION["id"])){    //Cuando este la session iniciada te muestra la pagina

if($_SESSION["rol"]=="administrador"){
?>

<!DOCTYPE html>
<html>
  	<head>
    		<meta charset="utf-8">
    		<title>Modificar Usuarios</title>
  	</head>

  	<body>
             <div class="contit"><h3>MODIFICAR USUARIOS</h3></div>
             


<?php
$holita=$_GET["id"];
echo $holita;

    $server = 'localhost';
    $username = 'user_wordpress';
    $password = '%myU_w3sql';
    $database = 'wordpress';


    try {
	$base = new PDO("mysql:host=$server;dbname=$database;", $username, $password);
	$base->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        $sql="SELECT * FROM usuarios where intIdUser = $holita ";

            $resultado=$base->prepare($sql);

            $resultado->execute();
            
            $numero_registro=$resultado->rowCount(); 
        
            foreach ($resultado as $row) {	//extrae los datos de la sql "El select" para crear la sesion abajo
		extract($row);
        
?>   
                   <form action="" method="POST">
                                  <input name="idUser" type="hidden" value="<?php echo $intIdUser; ?>"/>
                                  <input name="idEmail" type="text" value="<?php echo $vchEmail; ?>"/>
                                  <input type="submit" value="Modificar" name="estado" />
                   </form>

<?php
}

    }  catch (PDOException $e) {
	      die('Connection Failed: ' . $e->getMessage());
	} //cierre try y catch
?>

<?php

if(isset($_POST["estado"])) {
    $server = 'localhost';
    $username = 'user_wordpress';
    $password = '%myU_w3sql';
    $database = 'wordpress';


    try {
	$base = new PDO("mysql:host=$server;dbname=$database;", $username, $password);
	$base->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        $sql1="update usuarios set vchEmail = :estado where intIdUser= :idF";
        $resultado1=$base->prepare($sql1); 

        $resultado1->bindValue(":idF", $_POST["idUser"]);
        $resultado1->bindValue(":estado", $_POST["idEmail"]);
        $resultado1->execute();
        header('Location: https://www.grupo2ciber.com/?page_id=81');



    }  catch (PDOException $e) {
	      die('Connection Failed: ' . $e->getMessage());
	} //cierre try y catch

} //isset
?>

</body>
</html>

<?php
} else {
     header('Location: https://www.grupo2ciber.com/?page_id=37');
}
?>

<?php
} else {
      header('Location: https://www.grupo2ciber.com');     //Te redirige a la pagina de "LOGIN"
}
?>