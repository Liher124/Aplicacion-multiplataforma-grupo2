<?php
session_start();

if(isset($_SESSION["id"])){    //Cuando este la session iniciada te muestra la pagina
$use=$_SESSION["usuario"];
$ro=$_SESSION["rol"];
?>


<!-- *********************** HTML  ************************  -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Busqueda</title>

<style>
@import url("https://fonts.googleapis.com/css2?family=Sansita+Swashed:wght@600&display=swap");

body {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  justify-content: center;
  align-items: center;
  background: linear-gradient(0deg, #A2FAFF, #4EB9BF);  
}

input[type=number] {
margin-left:5px;
}
input[name=numero2] {
margin-left:12px;
}

@media screen and (max-width: 900px) {
       table {
           width:100%;
           background: #fff;
           border-collapse: collapse;
       }
       thead {
           display: none;
       }

       tr:nth-of-type(2n) {
           background-color: inherit;
       }

       tr td:first-child {
           background: #f0f0f0;
           font-weight:bold;
           font-size:1.3em;

       }
       tbody td {
           display: block;
           text-align:center;
       }
       tbody td:before {
           content: attr(data-th);
           display: block;
           text-align:center;
       }
}

input{
margin-bottom:20px;
}

       th {
            background-color:#16B4DB;
            color: #ffffff;
       }

       td {
            background-color: #f3f3f3;
            font-weight: bold;
            color: #40403f;
       }

</style>
</head>
<body>

<div class="contit"><h3>BUSQUEDA DE GASTOS POR IMPORTE</h3></div>
<form name="login" method="post" action="">


<h6>Importe Inicial :  
<input type="number" name="numero1" min="0" placeholder="10$" required=""><h6>

<h6>Importe Final :  
<input type="number" min="0" name="numero2" placeholder="100$" required=""><h6>

<input type="submit" name="buscarImporte" value="Buscar por Importe">

<h5 class="textoMess"><?php echo "Usuario conectado --> ".$use . "</br> Rol --> ".$ro; ?></h5>

</form>



<!-- *********************** PHP  ************************  -->

<?php
if(isset($_POST["buscarImporte"])){  //Nombre del boton del html
   
    $server = 'localhost';
    $username = 'user_wordpress';
    $password = '%myU_w3sql';
    $database = 'wordpress';
?>
    		<table class="default">
 		<tr>
    			<th>Fecha del gasto</th>
    			<th>Proyecto</th>
                        <th>Departamento</th>
    			<th>DÃ­as de Viaje</th>
    			<th>Distancia recorrida</th>
    			<th>Medio de Transporte</th>
    			<th>Precio Peaje</th>
    			<th>Precio Parking</th>
                        <th>Factura total</th>
                 </tr>

</body>
</html>

<?php

$idd=$_SESSION["id"];
$numeroI=$_POST["numero1"];
$numeroF=$_POST["numero2"];

    try {
        $base = new PDO("mysql:host=$server;dbname=$database;", $username, $password);
        $base->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);


        //$sql = "SELECT * FROM gastos WHERE intIdUser = $idd and doubleTotalFactura BETWEEN $numeroI AND $numeroF ";

$sql="SELECT proyecto.vchNombre as NombreProyecto, departamento.vchNombre as NombreDepartamento, dateDiasTotales, dateFechaHora, doubleTotalFactura, doubleDistanciaTotalKm, vchMediotransporte, doublePeaje, doubleParking from gastos left join departamento on departamento.intIdDepartamento = gastos.intIdDepartamento left join proyecto on proyecto.intIdProyecto = gastos.intIdProyecto where intIdUser = $idd and doubleTotalFactura BETWEEN $numeroI AND $numeroF";

        $stmt=$base->prepare($sql);
        $stmt->execute();
        $numero_registro=$stmt->rowCount(); 
        
            foreach ($stmt as $row) {	//extrae los datos de la sql "El select" para crear la sesion abajo
		extract($row);


?>
		 <tr>
                        <td><?php echo $dateFechaHora?></td>
			<td><?php echo $NombreProyecto?></td>
			<td><?php echo $NombreDepartamento?></td>
                        <td><?php echo $dateDiasTotales?></td>
                        <td><?php echo $doubleDistanciaTotalKm?></td>
                        <td><?php echo $vchMediotransporte?></td>
                        <td><?php echo $doublePeaje?></td>
                        <td><?php echo $doubleParking?></td>
                        <td><?php echo $doubleTotalFactura?></td>
                 <tr>
<?php
}//foreach

?>
</table>


<?php
    } catch (PDOException $e) {
        die('Connection Failed: ' . $e->getMessage());
    } 

 
} //isset




?>
</body>
</html>

<?php
} else {
      header('Location: https://www.grupo2ciber.com');     //Te redirige a la pagina de "LOGIN"
}
?>