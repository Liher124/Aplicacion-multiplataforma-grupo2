<?php
session_start();
if(isset($_SESSION["id"])){    //Cuando este la session iniciada te muestra la pagina

?>

<!-- *********************** HTML  ************************  -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Perfil Usuario</title>
<style>
 @import url("https://fonts.googleapis.com/css2?family=Sansita+Swashed:wght@600&display=swap");

body {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  justify-content: center;
  align-items: center;
  height: 100vh;

}

.center {
  position: relative;
  padding: 0px 50px;
  background: #fff;
  border-radius: 10px;
}
.center h1 {
  font-size: 2em;
  border-left: 5px solid dodgerblue;
  padding: 0px;
  color: #000;
  letter-spacing: 5px;
  margin-bottom: 40px;
  font-weight: bold;
  padding-left: 10px;
}

.styled-table {
    border-collapse: collapse;
    margin: 25px 0;
    font-size: 0.9em;
    font-family: sans-serif;
    min-width: 400px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);

}
.styled-table thead tr {
     background: linear-gradient(45deg, greenyellow, dodgerblue);
    color: #ffffff;
    text-align: left;
}

.styled-table th,
.styled-table td {
    padding: 12px 15px;
}
.styled-table tbody tr {
    border-bottom: 1px solid #dddddd;
}

.styled-table tbody tr:nth-of-type(even) {
    background-color: #f3f3f3;
}

.styled-table tbody tr:last-of-type {
    border-bottom: 2px solid #009879;
}

.styled-table tbody tr.active-row {
    font-weight: bold;
    color: #009879;
}

h5.textoMess {
  text-align:left;
  font-size: 15px;
  border-left: 5px solid #641E16;
  color: #000;
  letter-spacing: 5px;
  margin-bottom: 10px;
  font-weight: bold;
  padding-left: 10px;
  margin-left:54px;
}

div.imalp{
width:100px;
height:100px;
}

</style>
<!-- ******************************  HTML CABECERA TABLA  ***********************  -->
</head>
   <body>
      <div class="center">
           <h1 class="perfip">Informacion del Perfil</h1>
           <a class="im1"><img class="imagen" src="https://www.grupo2ciber.com/wp-content/uploads/2021/11/user.png" alt="Imagen de Usuario" width="200" height="150"></a>
           <table  class="styled-table">
                <thead>
 	            <tr>
    		        <th>Nombre Apellidos</th>
    		        <th>Dni</th>
    		        <th>Nombre Usuario</th>
    		        <th>Ultima Conexion</th>
  	             </tr>
                 </thead>
<!-- ******************************  CIERRE DE LA CABECERA DE LA TABLA  ***********************  -->

<!-- ******************************  PHP TABLA  ***********************  -->
<?php
//echo "Usuario".$_SESSION["usuario"];  //ver perfil de usuario echo
//echo "Id".$_SESSION["id"];            //ver la id de session usuario echo

if(isset($_SESSION["usuario"])){  //comprobacion que hay una sesion iniciada
    
        $server = 'localhost';
        $username = 'user_wordpress';
	$password = '%myU_w3sql';
	$database = 'wordpress';

        try {
	    $base = new PDO("mysql:host=$server;dbname=$database;", $username, $password);
	    $base->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            $sql="SELECT concat(vchNombre,' ',vchApellido1,' ',vchApellido2)as 'NombreCompleto',vchDni as 'Dni',vchNombreUser as 'Usu',dateUltimaConexion as 'Tiempo' FROM usuarios where intIdUser = :id";
            $resultado=$base->prepare($sql);
	    $id=$_SESSION["id"];
            $resultado->bindValue(":id", $id);

            $resultado->execute();
            
            $numero_registro=$resultado->rowCount(); 
        
            foreach ($resultado as $row) {	//extrae los datos de la sql "El select" para crear la sesion abajo
		extract($row);
                
	    }

            if($numero_registro!=0){      
?>

<!-- ******************************  FILA DE LA TABLA CON LAS CONSULTAS DE LA BASE DE DATOS  ***********************  -->   
                <tbody>
		     <tr class="active-row">
			  <td><?php echo "$NombreCompleto" ?></td>
			  <td><?php echo "$Dni" ?></td>
			  <td><?php echo "$Usu" ?></td>
			  <td><?php echo "$Tiempo" ?></td>
		     </tr>
	        </tbody>
<!-- ******************************  CIERRE DE LA FILA DE LA TABLA  ***********************  -->

<?php
            } else{
                echo "Error no hay datos en la tabla";
            } //Cierre else numero de registros

       }  catch (PDOException $e) {
	      die('Connection Failed: ' . $e->getMessage());
       } //Cierre try y catch

} else {
        echo "<script>alert('No has iniciado sesi√≥n');</script>";
} // Cierre isset y else
?>


<!-- ******************************  CIERRE PHP y HTML  ***********************  -->
<?php
$use=$_SESSION["usuario"];
$ro=$_SESSION["rol"];
?>

          </table>
       </div>
    <h5 class="textoMess"><?php echo "Usuario conectado --> ".$use . "</br> Rol --> ".$ro; ?></h5>
   </body>
</html>

<?php
} else {
      header('Location: https://www.grupo2ciber.com');     //Te redirige a la pagina de "LOGIN"
}
?>